<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Shoe Manufacturing Inventory Management System">
    <title>Shoe Manufacturing Inventory | Login</title>
    
    <!-- CSS Files -->
    <link rel="stylesheet" href="assets/css/main.css">
    <link rel="stylesheet" href="assets/css/components.css">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="assets/images/favicon.ico">
    
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="login-page">
    <!-- Navigation Drawer Toggle Button -->
    <button id="drawer-toggle" class="drawer-toggle" title="Open Navigation">
        <i class="fas fa-bars"></i>
    </button>

    <!-- Dynamic Navigation Drawer -->
    <div id="navigation-drawer" class="navigation-drawer">
        <div class="drawer-header">
            <div class="drawer-brand">
                <i class="fas fa-industry brand-icon"></i>
                <span class="brand-text">UPTOP Navigation</span>
            </div>
            <button id="drawer-close" class="drawer-close-btn">
                <i class="fas fa-times"></i>
            </button>
        </div>

        <div class="drawer-content">
            <!-- Main Pages Section -->
            <div class="drawer-section">
                <div class="section-title">
                    <i class="fas fa-home"></i>
                    Main Pages
                </div>
                <ul class="drawer-menu">
                    <li class="drawer-item active">
                        <a href="index.html" class="drawer-link">
                            <i class="fas fa-sign-in-alt"></i>
                            <span>Login / Home</span>
                        </a>
                    </li>
                    <li class="drawer-item">
                        <a href="dashboard.html" class="drawer-link">
                            <i class="fas fa-tachometer-alt"></i>
                            <span>Main Dashboard</span>
                        </a>
                    </li>
                </ul>
            </div>

            <!-- Inventory Management Section -->
            <div class="drawer-section">
                <div class="section-title">
                    <i class="fas fa-boxes"></i>
                    Inventory Management
                </div>
                <ul class="drawer-menu">
                    <li class="drawer-item">
                        <a href="dashboard.html#inventory" class="drawer-link">
                            <i class="fas fa-warehouse"></i>
                            <span>Inventory Overview</span>
                        </a>
                    </li>
                    <li class="drawer-item">
                        <a href="dashboard.html#production" class="drawer-link">
                            <i class="fas fa-industry"></i>
                            <span>Production</span>
                        </a>
                    </li>
                    <li class="drawer-item">
                        <a href="dashboard.html#export" class="drawer-link">
                            <i class="fas fa-shipping-fast"></i>
                            <span>Export & Sales</span>
                        </a>
                    </li>
                </ul>
            </div>

            <!-- Demo & Testing Section -->
            <div class="drawer-section">
                <div class="section-title">
                    <i class="fas fa-flask"></i>
                    Demo & Testing
                </div>
                <ul class="drawer-menu">
                    <li class="drawer-item">
                        <a href="inventory-app/demo.html" class="drawer-link external-link">
                            <i class="fas fa-play-circle"></i>
                            <span>Interactive Demo</span>
                            <i class="fas fa-external-link-alt external-icon"></i>
                        </a>
                    </li>
                    <li class="drawer-item">
                        <a href="inventory-app/dashboard.html" class="drawer-link external-link">
                            <i class="fas fa-chart-line"></i>
                            <span>Legacy Dashboard</span>
                            <i class="fas fa-external-link-alt external-icon"></i>
                        </a>
                    </li>
                    <li class="drawer-item">
                        <a href="inventory-app/index.html" class="drawer-link external-link">
                            <i class="fas fa-table"></i>
                            <span>Simple Table View</span>
                            <i class="fas fa-external-link-alt external-icon"></i>
                        </a>
                    </li>
                    <li class="drawer-item">
                        <a href="inventory-app/test-simple.html" class="drawer-link external-link">
                            <i class="fas fa-vial"></i>
                            <span>Connection Test</span>
                            <i class="fas fa-external-link-alt external-icon"></i>
                        </a>
                    </li>
                </ul>
            </div>

            <!-- Quick Actions Section -->
            <div class="drawer-section">
                <div class="section-title">
                    <i class="fas fa-bolt"></i>
                    Quick Actions
                </div>
                <div class="quick-actions">
                    <button class="quick-action-btn" onclick="openDashboard()">
                        <i class="fas fa-tachometer-alt"></i>
                        <span>Open Dashboard</span>
                    </button>
                    <button class="quick-action-btn" onclick="openDemo()">
                        <i class="fas fa-play"></i>
                        <span>Try Demo</span>
                    </button>
                    <button class="quick-action-btn" onclick="testConnection()">
                        <i class="fas fa-wifi"></i>
                        <span>Test Connection</span>
                    </button>
                </div>
            </div>
        </div>

        <div class="drawer-footer">
            <div class="system-status">
                <div class="status-item">
                    <i class="fas fa-circle status-online"></i>
                    <span>System Online</span>
                </div>
                <div class="version-info">v1.0.0</div>
            </div>
        </div>
    </div>

    <!-- Drawer Overlay -->
    <div id="drawer-overlay" class="drawer-overlay"></div>

    <!-- Loading Spinner -->
    <div id="loading-spinner" class="loading-spinner hidden">
        <div class="spinner"></div>
        <p>Loading...</p>
    </div>

    <!-- Login Container -->
    <div id="login-container" class="login-container">
        <div class="login-card">
            <div class="login-header">
                <div class="logo-placeholder">
                    <i class="fas fa-industry"></i>
                </div>
                <h1>Shoe Manufacturing</h1>
                <h2>Inventory Management System</h2>
            </div>
            
            <form id="login-form" class="login-form">
                <div class="form-group">
                    <label for="username">Username</label>
                    <input type="text" id="username" name="username" required>
                    <i class="fas fa-user input-icon"></i>
                </div>
                
                <div class="form-group">
                    <label for="password">Password</label>
                    <input type="password" id="password" name="password" required>
                    <i class="fas fa-lock input-icon"></i>
                    <button type="button" class="toggle-password" onclick="togglePassword()">
                        <i class="fas fa-eye"></i>
                    </button>
                </div>
                
                <div class="form-group">
                    <label for="role">Role</label>
                    <select id="role" name="role" required>
                        <option value="">Select Role</option>
                        <option value="admin">Admin</option>
                        <option value="accounts">Accounts</option>
                        <option value="production">Production</option>
                        <option value="export">Export</option>
                    </select>
                    <i class="fas fa-user-tag input-icon"></i>
                </div>
                
                <button type="submit" class="login-btn">
                    <i class="fas fa-sign-in-alt"></i>
                    Login
                </button>

                <div class="dashboard-buttons" style="margin-top: 10px; display: flex; gap: 10px;">
                    <button type="button" class="btn btn-secondary" onclick="window.location.href='dashboard.html'" style="flex: 1;">
                        <i class="fas fa-tachometer-alt"></i>
                        Go to Dashboard
                    </button>
                    <button type="button" class="btn btn-outline" onclick="window.open('dashboard.html', '_blank')" style="flex: 1;">
                        <i class="fas fa-external-link-alt"></i>
                        New Tab
                    </button>
                </div>
                
                <div class="login-options">
                    <label class="remember-me">
                        <input type="checkbox" id="remember-me">
                        <span class="checkmark"></span>
                        Remember me
                    </label>
                    <a href="#" class="forgot-password">Forgot Password?</a>
                </div>

                <div class="auth-toggle">
                    <p>Don't have an account? <a href="#" id="show-signup">Sign up here</a></p>
                </div>
            </form>

            <!-- Signup Form (Hidden by default) -->
            <form id="signup-form" class="signup-form hidden">
                <div class="form-group">
                    <label for="signup-name">Full Name</label>
                    <input type="text" id="signup-name" name="name" required>
                    <i class="fas fa-user input-icon"></i>
                </div>

                <div class="form-group">
                    <label for="signup-email">Email</label>
                    <input type="email" id="signup-email" name="email" required>
                    <i class="fas fa-envelope input-icon"></i>
                </div>

                <div class="form-group">
                    <label for="signup-username">Username</label>
                    <input type="text" id="signup-username" name="username" required>
                    <i class="fas fa-user input-icon"></i>
                </div>

                <div class="form-group">
                    <label for="signup-password">Password</label>
                    <input type="password" id="signup-password" name="password" required>
                    <i class="fas fa-lock input-icon"></i>
                    <button type="button" class="toggle-password" onclick="toggleSignupPassword()">
                        <i class="fas fa-eye"></i>
                    </button>
                </div>

                <div class="form-group">
                    <label for="signup-role">Role</label>
                    <select id="signup-role" name="role" required>
                        <option value="">Select Role</option>
                        <option value="accounts">Accounts</option>
                        <option value="production">Production</option>
                        <option value="export">Export</option>
                    </select>
                    <i class="fas fa-user-tag input-icon"></i>
                </div>

                <button type="submit" class="login-btn">
                    <i class="fas fa-user-plus"></i>
                    Sign Up
                </button>

                <div class="auth-toggle">
                    <p>Already have an account? <a href="#" id="show-login">Login here</a></p>
                </div>
            </form>

            <div id="error-message" class="error-message hidden">
                <i class="fas fa-exclamation-triangle"></i>
                <span id="error-text"></span>
            </div>

            <div id="success-message" class="success-message hidden">
                <i class="fas fa-check-circle"></i>
                <span id="success-text"></span>
            </div>
        </div>
        
        <div class="login-footer">
            <p>&copy; 2024 Shoe Manufacturing Co. All rights reserved.</p>
            <div class="system-info">
                <span>Version 1.0.0</span>
                <span>|</span>
                <span>Support: support@shoemanufacturing.com</span>
            </div>
        </div>
    </div>

    <!-- Main App Container (Hidden initially) -->
    <div id="app-container" class="app-container hidden">
        <!-- Content will be loaded here after login -->
    </div>

    <!-- Scripts -->
    <script src="js/config.js"></script>
    <script src="js/utils/helpers.js"></script>
    <script src="js/utils/validators.js"></script>
    <script src="js/services/authService.js"></script>
    <script src="js/state/state.js"></script>
    <script src="js/state/events.js"></script>
    <script src="js/router.js"></script>
    <script src="js/app.js"></script>
    
    <script>
        // Toggle password visibility
        function togglePassword() {
            const passwordInput = document.getElementById('password');
            const toggleBtn = document.querySelector('.toggle-password i');

            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                toggleBtn.classList.remove('fa-eye');
                toggleBtn.classList.add('fa-eye-slash');
            } else {
                passwordInput.type = 'password';
                toggleBtn.classList.remove('fa-eye-slash');
                toggleBtn.classList.add('fa-eye');
            }
        }

        function toggleSignupPassword() {
            const passwordInput = document.getElementById('signup-password');
            const toggleBtn = document.querySelector('#signup-form .toggle-password i');

            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                toggleBtn.classList.remove('fa-eye');
                toggleBtn.classList.add('fa-eye-slash');
            } else {
                passwordInput.type = 'password';
                toggleBtn.classList.remove('fa-eye-slash');
                toggleBtn.classList.add('fa-eye');
            }
        }

        // Toggle between login and signup forms
        function showSignupForm() {
            document.getElementById('login-form').classList.add('hidden');
            document.getElementById('signup-form').classList.remove('hidden');
            document.querySelector('.login-header h2').textContent = 'Create Account';
        }

        function showLoginForm() {
            document.getElementById('signup-form').classList.add('hidden');
            document.getElementById('login-form').classList.remove('hidden');
            document.querySelector('.login-header h2').textContent = 'Welcome Back';
        }

        // Handle signup form submission
        async function handleSignup(event) {
            event.preventDefault();

            const formData = new FormData(event.target);
            const userData = {
                name: formData.get('name'),
                email: formData.get('email'),
                username: formData.get('username'),
                password: formData.get('password'),
                role: formData.get('role')
            };

            try {
                showLoading(true);
                hideMessages();

                // Call the signup function
                const newUser = await AuthService.signup(userData);

                showSuccess('Account created successfully! You can now login.');

                // Switch back to login form after 2 seconds
                setTimeout(() => {
                    showLoginForm();
                    // Pre-fill username
                    document.getElementById('username').value = userData.username;
                    document.getElementById('role').value = userData.role;
                }, 2000);

            } catch (error) {
                showError(error.message);
            } finally {
                showLoading(false);
            }
        }

        function showSuccess(message) {
            const successDiv = document.getElementById('success-message');
            const successText = document.getElementById('success-text');
            successText.textContent = message;
            successDiv.classList.remove('hidden');
        }

        function hideMessages() {
            document.getElementById('error-message').classList.add('hidden');
            document.getElementById('success-message').classList.add('hidden');
        }

        // Dynamic Drawer Functionality
        function initializeDrawer() {
            const drawerToggle = document.getElementById('drawer-toggle');
            const drawerClose = document.getElementById('drawer-close');
            const drawer = document.getElementById('navigation-drawer');
            const overlay = document.getElementById('drawer-overlay');
            const drawerLinks = document.querySelectorAll('.drawer-link');

            // Open drawer
            function openDrawer() {
                drawer.classList.add('open');
                overlay.classList.add('active');
                document.body.classList.add('drawer-open');
            }

            // Close drawer
            function closeDrawer() {
                drawer.classList.remove('open');
                overlay.classList.remove('active');
                document.body.classList.remove('drawer-open');
            }

            // Toggle drawer
            function toggleDrawer() {
                if (drawer.classList.contains('open')) {
                    closeDrawer();
                } else {
                    openDrawer();
                }
            }

            // Event listeners
            drawerToggle.addEventListener('click', toggleDrawer);
            drawerClose.addEventListener('click', closeDrawer);
            overlay.addEventListener('click', closeDrawer);

            // Handle drawer link clicks
            drawerLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    // Add loading state
                    const icon = this.querySelector('i');
                    const originalClass = icon.className;
                    icon.className = 'fas fa-spinner fa-spin';

                    // Restore icon after delay
                    setTimeout(() => {
                        icon.className = originalClass;
                    }, 1000);

                    // Close drawer on mobile
                    if (window.innerWidth <= 768) {
                        setTimeout(closeDrawer, 300);
                    }
                });
            });

            // Close drawer on escape key
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape' && drawer.classList.contains('open')) {
                    closeDrawer();
                }
            });

            // Handle window resize
            window.addEventListener('resize', function() {
                if (window.innerWidth > 768) {
                    closeDrawer();
                }
            });
        }

        // Quick Action Functions
        function openDashboard() {
            showLoading(true);
            setTimeout(() => {
                window.location.href = 'dashboard.html';
            }, 500);
        }

        function openDemo() {
            showLoading(true);
            setTimeout(() => {
                window.location.href = 'inventory-app/demo.html';
            }, 500);
        }

        function testConnection() {
            showLoading(true);
            setTimeout(() => {
                window.location.href = 'inventory-app/test-simple.html';
            }, 500);
        }

        // Update drawer active state based on current page
        function updateDrawerActiveState() {
            const currentPage = window.location.pathname.split('/').pop() || 'index.html';
            const drawerItems = document.querySelectorAll('.drawer-item');

            drawerItems.forEach(item => {
                item.classList.remove('active');
                const link = item.querySelector('.drawer-link');
                const href = link.getAttribute('href');

                if (href === currentPage ||
                    (currentPage === 'index.html' && href === 'index.html') ||
                    href.includes(currentPage)) {
                    item.classList.add('active');
                }
            });
        }

        // Initialize app when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            App.init();

            // Initialize dynamic drawer
            initializeDrawer();
            updateDrawerActiveState();

            // Add event listeners for form toggles
            document.getElementById('show-signup').addEventListener('click', function(e) {
                e.preventDefault();
                showSignupForm();
            });

            document.getElementById('show-login').addEventListener('click', function(e) {
                e.preventDefault();
                showLoginForm();
            });

            // Add signup form submission handler
            document.getElementById('signup-form').addEventListener('submit', handleSignup);
        });
    </script>
</body>
</html>
